<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: modules/result/view/result/index.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: modules/result/view/result/index.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import React,{Component,Fragment} from 'react';
import gql from 'graphql-tag';
import {graphql} from "react-apollo";
import qp from 'query-parse';
import {Container} from "../../../../blocks/container/index";
import Button from '../../../../blocks/button/button';
import {Top} from "../../../../components/top/index";
import {Row} from "../../../../blocks/row/index";
import {TopLabel,TopLabelRow} from "../../../../components/topLabel/index";
import {Typography} from '../../../../blocks/typography/index';
import {Link,Redirect} from 'react-router-dom';
import {Image} from "../../../../blocks/image/index";
import {getTranslate,getActiveLanguage} from 'react-localize-redux';
import {connect} from "react-redux";
import iconHome from '../../../../assets/icons/icon_home.svg';
import {PreLoader} from "../../../../components/preloader/index";

const createCertificate = gql`mutation createCertificate(
    $name: String!,
    $notarizationCreateTime: String,
    $paymentId: String,
    $PayerID: String,
    $language: String,
    ){
        createCertificate(
            name:$name,
            notarizationCreateTime: $notarizationCreateTime,
            paymentId: $paymentId,
            PayerID: $PayerID,
            language: $language,
        ) {
            name
            notarizationCreateTime
            paymentId
            PayerID
            blockChainAddress
        }
    }`;


class Result extends Component {
    static propTypes = {
        /** @property {func} translate   */
        translate: PropTypes.func
    }

    static defaultProps = {};

    constructor(props) {
        super(props);
        this.state = this.initialState;
        this.createCertificate = this.createCertificate.bind(this);
        this.createCertificateData = this.createCertificateData.bind(this);
        this.addEventListenerCloseWindow = this.addEventListenerCloseWindow.bind(this);
        this.removeEventListenerCloseWindow = this.removeEventListenerCloseWindow.bind(this);

        this.addEventListenerCloseWindow();
    }

    get initialState() {
        return {
            preLoader: true,
            error: false,
            redirect: false,
        }
    }

    componentDidMount() {
        console.log('run componentDidMount...');
        this.createCertificate();
    }
    /**
     * @description Scope data from ReduxForm and lockalstorage and send mutation Create Certificate to backend
     * @returns Status answer. 200 Ok or some else
     * @memberof Result
     */
    createCertificate() {
        console.log('run createCertificate...');
        if (!process.env.__isBrowser__) return null;
        /**
         * @description Create object to send
         */
        const name = localStorage.getItem('fileHash');
        const notarizationDate = Number.parseInt(localStorage.getItem('timestamp')); //timestam from notar
        const url = qp.toObject(window.location.search.substring(1));
        const paymentId = url.paymentId;
        const PayerID = url.PayerID;
        const obj = {name, notarizationDate, paymentId, PayerID};
        const data = {variables: obj};
        /**
         * @description Sent data to backend and handle фтыцук
         */
        this.props.createCertificate(data).then((res)=>{
            console.log(res);
            localStorage.clear();
        }).catch((err) => {
            console.log(err);
        });
    }

    render() {
        const {translate} = this.props;
        const {preLoader,redirect} = this.state;
        if (redirect) {
            return &lt;Redirect to={redirect}/>
        }
        return (
            &lt;Fragment>
                &lt;Top paddingBottom={'7rem'}>
                    {translate('result_сongratulations')}
                &lt;/Top>
                &lt;Container>
                    &lt;TopLabelRow>
                        &lt;TopLabel isActive>
                            &lt;Typography styles={{padding: '0.5rem'}} as={'h2'} size={'large'}
                                fontWeight={'bold'} textAlign={'center'}
                                textTransform={'uppercase'}
                                color={'secondary'} bright={'contrastText'}>  
                                    {translate('result_file_notar')}
                            &lt;/Typography>
                            &lt;Typography styles={{padding: '0.5rem',maxWidth: '30rem'}} as={'p'} textAlign={'center'}
                                color={'secondary'} bright={'contrastText'}>
                                {translate('result_description')}
                            &lt;/Typography>
                            &lt;Row>
                                &lt;Link to='/' style={{textDecoration: 'none',display: 'block',textAlign: 'center'}}>
                                    &lt;Button styles={{textDecoration: 'none'}} size={'medium'} variant={'raised'} color={'primary'}>
                                        &lt;Image src={iconHome} styles={{padding: '0.2rem'}}/>
                                        &lt;Typography as={'p'} size={'small'} color={'secondary'} bright={'contrastText'}>
                                        {translate('result_home')}
                                        &lt;/Typography>
                                    &lt;/Button>
                                &lt;/Link>
                            &lt;/Row>
                        &lt;/TopLabel>
                    &lt;/TopLabelRow>
                &lt;/Container>
            &lt;/Fragment>
        )
    }
}


Result = graphql(createCertificate,{
    name: 'createCertificate',
    mutate: {
        fetchPolicy: 'no-cache',
        errorPolicy: 'all'
    }
})(Result);

const mapStateToProps = state => ({
    translate: getTranslate(state.locale),
    currentLanguage: getActiveLanguage(state.locale).code
});


export default connect(mapStateToProps)(Result);
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="LanguageSwitcher.html">LanguageSwitcher</a></li><li><a href="Verify.VerifyModal.html">VerifyModal</a></li><li><a href="Verify.VerifyPage.html">VerifyPage</a></li></ul><h3>Global</h3><ul><li><a href="global.html#addFlexMS">addFlexMS</a></li><li><a href="global.html#btnStyles">btnStyles</a></li><li><a href="global.html#createRoutes">createRoutes</a></li><li><a href="global.html#createStyleRenderer">createStyleRenderer</a></li><li><a href="global.html#currentLanguage">currentLanguage</a></li><li><a href="global.html#error">error</a></li><li><a href="global.html#handleSubmit">handleSubmit</a></li><li><a href="global.html#has">has</a></li><li><a href="global.html#hash">hash</a></li><li><a href="global.html#initLocalize">initLocalize</a></li><li><a href="global.html#instruction">instruction</a></li><li><a href="global.html#language">language</a></li><li><a href="global.html#languages">languages</a></li><li><a href="global.html#onModalToggle">onModalToggle</a></li><li><a href="global.html#open">open</a></li><li><a href="global.html#pristine">pristine</a></li><li><a href="global.html#rehydrateState">rehydrateState</a></li><li><a href="global.html#renderer">renderer</a></li><li><a href="global.html#reset">reset</a></li><li><a href="global.html#ROOT">ROOT</a></li><li><a href="global.html#setActiveLanguage">setActiveLanguage</a></li><li><a href="global.html#staticContext">staticContext</a></li><li><a href="global.html#styles">styles</a></li><li><a href="global.html#submitting">submitting</a></li><li><a href="global.html#translate">translate</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.5</a> on Fri Jun 01 2018 13:15:57 GMT+0300 (MSK)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
