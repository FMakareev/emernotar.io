<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: modules/verify/view/verify/verify_modal.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: modules/verify/view/verify/verify_modal.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import React, {Component, Fragment} from 'react';
import PropTypes from 'prop-types';
import Modal from 'react-responsive-modal';
import gql from 'graphql-tag';
import {Mutation,graphql} from "react-apollo";

import {Typography} from "../../../../blocks/typography/index";
import {connect as connectFela} from 'react-fela';
import {Field,reduxForm} from "redux-form";
import {Button} from "../../../../blocks/button/index";
import {InputText} from "../../../../blocks/input-fela/input_text/input_text";
import {Image} from "../../../../blocks/image/index";
import {Checkbox} from '../../../../blocks/input-fela/input_checkbox-group/input_checkbox-group';
import {RadioGroup,Radio} from '../../../../blocks/input-fela/input_radio-group/input_radio-group';
import {getTranslate,getActiveLanguage} from 'react-localize-redux';

import iconNotar from '../../../../assets/icons/icon_notorize-black.svg';
import {connect} from "react-redux";
import {PreLoader} from "../../../../components/preloader/index";


const createNotarization = gql`mutation createNotarization(
    $name: String!,
    $emailHashed: Boolean,
    $docName: String,
    $additionalInfo: String,
    $notarizationCreateTime: String,
    ){
        createNotarization(
            name:$name,
            emailHashed:$emailHashed,
            docName:$docName,
            additionalInfo:$additionalInfo,
            notarizationCreateTime:$notarizationCreateTime
        ) {
            name
            emailHashed
            docName
            additionalInfo
            notarizationCreateTime
        }
    }`;

    
    /**
     * @description Modal that receives information and sends a mutation crateNotarization
     * @returns request with code answer
     * @memberof Verify
     */

class VerifyModal extends Component {

    static propTypes = {
        /** @property {func} translate   */
        translate: PropTypes.func,
        /** @property {bool} open   */
        open: PropTypes.bool,
        /** @property {func} onModalToggle   */
        onModalToggle: PropTypes.func,
        /** @property {func} handleSubmit   */
        handleSubmit: PropTypes.func, 
        /** @property {func} reset   */
        reset: PropTypes.func, 
        /** @property {string} error   */
        error: PropTypes.string, 
        /** @property {bool} prestine   */
        pristine: PropTypes.bool, 
        /** @property {func} submitting   */
        submitting: PropTypes.func,
        /** @property {shape} styles   */
        styles: PropTypes.shape({
            VerifyModalWrapper: PropTypes.string,
            VerifyModalHeader: PropTypes.string,
            VerifyModalContent: PropTypes.string,
            VerifyModalFooter: PropTypes.string,
            VerifyModalFooterText: PropTypes.string,
        }),
    }

    constructor(props) {
        super(props);
        this.state = this.initialState;
        this.handleChange = this.handleChange.bind(this);
        this.submit = this.submit.bind(this);
        this.onPreLoaderToggle = this.onPreLoaderToggle.bind(this);
        this.maxLength = this.maxLength.bind(this);
    }

    componentDidMount() { }

    handleChange(value) {
        console.log(value);
        this.setState({emailHashed: value});
    }

    get initialState() {
        return {
            emailHashed: null,
            emailHashedMessage: null,
        };
    }
    /**
     * @description Submit function. Send mutation createNotarization
     * @param {any} value 
     * @memberof VerifyModal
     */
    submit(value) {
        /**
         * @description Get param from localstorage. Set timestamp
         */
        const name = localStorage.getItem('fileHash');
        const docName = localStorage.getItem('fileName');
        const creationTime = Math.floor(Date.now() / 1000);
        localStorage.setItem('timestamp', creationTime);

        /**
         * @description Create obgect for  mutation
         */
        let obj = {name, docName, creationTime, ...value, emailHashed: this.state.emailHashed};
        if (!obj.hasOwnProperty('additionalInfo') || !obj.additionalInfo) {
            obj.additionalInfo = '';
        }
        let data = {variables: obj};
        this.setState({responseData: data});

        /**
         * @description Close modal. Set preloader
         */
        this.props.onModalToggle(false);
        this.onPreLoaderToggle(true);

        /**
         * @description Send requert to backend. Redirect to paypal
         */
        this.props.createNotarization(data).then((res) => {
            console.log("createNotarization", res);
            window.location.replace(`/paypal/paypal`);
        }).catch((err) => {
            console.log(err);
        })
    }
    /**
     * @description set loading, preloader
     */
    onPreLoaderToggle(state) {
        console.log(open);
        this.setState({preLoader: state})
    }

    maxLength(value){
        return value &amp;&amp; value.length > 1500 ? this.props.translate('verify_modal_additional_maxlength') : undefined
    }

    render() {
        const {open, onModalToggle, styles, handleSubmit, reset, error, pristine, submitting, translate} = this.props;
        console.log(open);
        const {preLoader} = this.state;
        return (
            &lt;Fragment>
                &lt;Modal
                    open={open}
                    classNames={{modal: styles.VerifyModalWrapper}}
                    onClose={() => onModalToggle(!open)}
                    little>

                    &lt;div className={styles.VerifyModalHeader}>
                        &lt;Typography as={'h3'} size={'large'}
                                    fontWeight={'bold'} textAlign={'center'}
                                    textTransform={'uppercase'}
                                    color={'secondary'} bright={'contrastText'}>
                            {translate('verify_modal_title')}
                        &lt;/Typography>
                    &lt;/div>
                    &lt;form onSubmit={handleSubmit((value) => this.submit(value))}>
                        &lt;RadioGroup name="emailHashed"
                                    selectedValue={this.state.emailHashed}
                                    onChange={this.handleChange}
                        >
                            &lt;div style={{
                                marginBottom: '0.5rem',
                            }}>
                                &lt;Radio value={true}/>{translate('verify_modal_hash_email')}
                                &lt;Typography  styles={{
                                    fontStyle: 'italic',
                                    paddingLeft: '20px',
                                }} as={'div'} size={'small'} textDecoration={'none'} color={'secondary'}
                                             bright={'contrastText'}>
                                    {translate('verify_modal_hash_email_description')}
                                &lt;/Typography>
                            &lt;/div>
                            &lt;div style={{
                                marginBottom: '0.5rem',
                            }}>
                                &lt;Radio value={false} checked/>{translate('verify_modal_open_email')}
                                &lt;Typography  styles={{
                                    fontStyle: 'italic',
                                    paddingLeft: '20px',
                                }} as={'div'} size={'small'} textDecoration={'none'} color={'secondary'}
                                             bright={'contrastText'}>
                                    {translate('verify_modal_open_email_description')}
                                &lt;/Typography>
                            &lt;/div>
                            {
                                this.state.emailHashedMessage &amp;&amp; &lt;div>
                                    &lt;Typography  styles={{
                                        paddingLeft: '20px',
                                    }}  as={'p'} size={'small'} textDecoration={'none'} color={'error'}
                                                bright={'main'}>
                                        {this.state.emailHashedMessage}
                                    &lt;/Typography>
                                &lt;/div>
                            }

                        &lt;/RadioGroup>
                        &lt;br/>
                        &lt;label htmlFor="">
                            &lt;Typography as={'p'} size={'small'} textDecoration={'none'} color={'secondary'}
                                        bright={'contrastText'}>
                                {translate('verify_modal_additional_label')}
                            &lt;/Typography>
                            &lt;Field
                                name="additionalInfo"
                                component={InputText}
                                placeholder={translate('verify_modal_additional_textarea')}
                                type="textarea"
                                validate={[ this.maxLength ]}
                            />

                        &lt;/label>
                        {error &amp;&amp; &lt;strong>{error}&lt;/strong>}

                        &lt;div className={styles.VerifyModalFooter}>
                            &lt;Button variant={'raised'} color={'primary'}
                                    type="submit"
                                    styles={{textAlign: 'center'}}>
                                &lt;Image src={iconNotar} styles={{padding: '0.2rem',maxWidth: '40px'}}/>

                                &lt;Typography as={'p'} size={'small'} textDecoration={'none'} color={'secondary'}
                                            bright={'contrastText'}>

                                    {translate('verify_modal_btn_submit')}
                                &lt;/Typography>
                            &lt;/Button>
                        &lt;/div>
                    &lt;/form>
                &lt;/Modal>

                {
                    preLoader &amp;&amp; &lt;PreLoader backdrop/>
                }
            &lt;/Fragment>);
    }
}

const STYLE = () => {
    return {
        VerifyModalWrapper: {
            backgroundColor: '#FDF396 !important',
            margin: '0 auto',
            maxHeight: '650px'
        },
        VerifyModalHeader: {
            padding: '1rem 2rem !important',
        },
        VerifyModalContent: {
            padding: '1rem 2rem !important'
        },
        VerifyModalFooter: {
            padding: '1rem 2rem !important',
            textAlign: 'center',
        },
        VerifyModalFooterText: {
            padding: '1rem 2rem !important',
        },
    }
};

VerifyModal = connectFela(STYLE)(VerifyModal);

VerifyModal = reduxForm({
    form: 'VerifyModal',
})(VerifyModal);

VerifyModal = graphql(createNotarization,{
    name: 'createNotarization',
    mutate: {
        fetchPolicy: 'no-cache',
        errorPolicy: 'all'
    }
})(VerifyModal);

const mapStateToProps = state => ({
    translate: getTranslate(state.locale),
    currentLanguage: getActiveLanguage(state.locale).code
});


export default connect(mapStateToProps)(VerifyModal);

</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="LanguageSwitcher.html">LanguageSwitcher</a></li><li><a href="Verify.VerifyModal.html">VerifyModal</a></li><li><a href="Verify.VerifyPage.html">VerifyPage</a></li></ul><h3>Global</h3><ul><li><a href="global.html#addFlexMS">addFlexMS</a></li><li><a href="global.html#btnStyles">btnStyles</a></li><li><a href="global.html#createRoutes">createRoutes</a></li><li><a href="global.html#createStyleRenderer">createStyleRenderer</a></li><li><a href="global.html#currentLanguage">currentLanguage</a></li><li><a href="global.html#error">error</a></li><li><a href="global.html#handleSubmit">handleSubmit</a></li><li><a href="global.html#has">has</a></li><li><a href="global.html#hash">hash</a></li><li><a href="global.html#initLocalize">initLocalize</a></li><li><a href="global.html#instruction">instruction</a></li><li><a href="global.html#language">language</a></li><li><a href="global.html#languages">languages</a></li><li><a href="global.html#onModalToggle">onModalToggle</a></li><li><a href="global.html#open">open</a></li><li><a href="global.html#pristine">pristine</a></li><li><a href="global.html#rehydrateState">rehydrateState</a></li><li><a href="global.html#renderer">renderer</a></li><li><a href="global.html#reset">reset</a></li><li><a href="global.html#ROOT">ROOT</a></li><li><a href="global.html#setActiveLanguage">setActiveLanguage</a></li><li><a href="global.html#staticContext">staticContext</a></li><li><a href="global.html#styles">styles</a></li><li><a href="global.html#submitting">submitting</a></li><li><a href="global.html#translate">translate</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.5</a> on Fri Jun 01 2018 13:15:57 GMT+0300 (MSK)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
